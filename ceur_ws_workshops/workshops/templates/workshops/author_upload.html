{% extends "workshops/workshop_edit_success.html" %}
{% load static %}

{% block content %}
  <h2 class="header-title">Submit Paper</h2>
    
  <!-- Paper Form -->
    <form method="post" id="form-container" enctype="multipart/form-data">

        <fieldset>
        {% csrf_token %}
        {{ paper_form.as_p }}
        </fieldset>
      
  <hr>
  <fieldset id="author-fieldset">
    {{author_formset.management_form}}
    <div class="form-set">
    {% for form in author_formset %}
        <div class="author-form">
        {{author_formset.as_p}}
        <hr>
        </div>
        {% endfor %}
    </div>
        <button id="add-form" type="button" class = "button-13">Add Author</button>
    </fieldset>
    <br>
    <input type="submit" class = "button-13" value="Save Paper">
  </form>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
    let addButton = document.querySelector("#add-form");
    let formSet = document.querySelector("#author-fieldset");
    let totalForms = document.querySelector("#id_form-TOTAL_FORMS");

    function addForm(e) {
      e.preventDefault();

      let formNum = formSet.querySelectorAll(".author-form").length -1;
      let newForm = formSet.querySelector(".author-form").cloneNode(true);
      let formRegex = RegExp(`form-(\\d+)-`, 'g');

      formNum++;
      newForm.innerHTML = newForm.innerHTML.replace(formRegex, `form-${formNum}-`);
      
      formSet.insertBefore(newForm, addButton);

      totalForms.value = formNum + 1;
    }

    addButton.addEventListener('click', addForm);
  });
  
</script>

{% endblock %}

