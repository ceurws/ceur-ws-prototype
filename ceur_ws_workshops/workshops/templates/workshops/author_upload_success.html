{% extends 'workshops/edit_author.html' %}
{% load static %}
{% block content %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Paper Submitted Correctly</title>
  <link rel="stylesheet" href="{% static 'ceur_ws_workshops/workshops/static/workshops/styles.css' %}">
</head>

<body>
  {% if edit_mode %}
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <fieldset>
      <legend>Paper Details</legend>
      {{ paper_form.as_p }}
      <p>Uploaded File: <a href="{{ paper_form.instance.uploaded_file.url }}">{{ paper_form.instance.uploaded_file.name }}</a></p>
      <p>Agreement File: <a href="{{ paper_form.instance.agreement_file.url }}">{{ paper_form.instance.agreement_file.name }}</a></p>
    </fieldset>

    <fieldset id="author-fieldset">
      <legend>Author Details</legend>
      {{ author_formset.management_form }}
      <div id="author-form" class="author-form">
        <!-- {{ author_formset.as_p }} -->
        {% for form in author_formset %}
        {{ form.as_p }}
      {% endfor %}
    </div>
      <input type="button" value="Add Author" class="button-13" id="add_author">
    </fieldset>

    <input type="submit" name="submit_button" class="button-13" value="Confirm">
  </form>

  <div id="empty_author_form" style="display:none">
    <table class='no_error'>
      {{ author_formset.empty_form }}
      <br>
    </table>
  </div>
  
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      let messages = Array.from(document.querySelectorAll('#django-messages [data-message]')).map(el => el.getAttribute('data-message'));
    });
  
    $('#add_author').click(function () {
      var form_idx = $('#id_author-TOTAL_FORMS').val();
      $('#author-form').append($('#empty_author_form').html().replace(/__prefix__/g, form_idx));
      $('#id_author-TOTAL_FORMS').val(parseInt(form_idx) + 1);
    });
  </script>
  {% else %}
  <h1>Paper Submitted Correctly</h1>
  <p>Your author and metadata have been successfully uploaded to <strong>{{ workshop.workshop_full_title }}</strong>.</p>
  <fieldset class="paper-details">
    <legend>Paper Details</legend>
    <p><strong>Paper Title:</strong> {{ paper.paper_title }}</p>
    <p><strong>Pages:</strong> {{ paper.pages }}</p>
    <p><strong>Uploaded File:</strong> <a href="{{ paper.uploaded_file.url }}" target="_blank">{{ paper.uploaded_file.name }}</a></p>
    <p><strong>Uploaded Agreement:</strong> <a href="{{ paper.agreement_file.url }}" target="_blank">{{ paper.agreement_file.name }}</a></p>
    <p><strong>Session:</strong> {{ paper.session }}</p>
  </fieldset>
  <br>
  <fieldset>
    <legend>Paper Author Details:</legend>
    <ul>
      {% for author in paper.authors.all %}
      <li><strong>Name:</strong> {{ author.author_name }}</li>
      <li><strong>University:</strong> {{ author.author_university }}</li>
      <li><strong>University URL:</strong> <a href="{{ author.author_uni_url }}">{{ author.author_uni_url }}</a></li>
      <li><strong>Email:</strong> {{ author.author_email }}</li>
      <hr>
      {% endfor %}
    </ul>
  </fieldset>

  <div class="tooltip">
    <i>If you wish to make further changes at a later stage please save this url:</i>
    <br>
    <a id="author_url" href="{{ request.build_absolute_uri }}" target="_blank">Author edit URL</a>
    <button class="copy_clipboard" onclick="CopyText('author_url', 'myTooltip')" onmouseout="outFunc('myTooltip')">
      <span class="tooltiptext" id="myTooltip">Copy to clipboard</span>
      <img src="{% static 'workshops/icons8-copy-24.png' %}" alt="Copy to clipboard" width="20" height="20">
    </button>
  </div>

  <form method="post" id="form-container" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="submit" name="edit_button" class="button-13" value="Edit">
  </form>
  {% endif %}

  {% if messages %}
  <div id="messageModal" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Notice</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          {% for message in messages %}
          <p>{{ message }}</p>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  <script>
    $(document).ready(function () {
      $("#messageModal").modal('show');
    });
  </script>
  {% endif %}
</body>

</html>
{% endblock %}
