{% extends 'workshops/index.html' %}
{% load static %}
{% block content %}

<form method="post" id="form-container" enctype="multipart/form-data">
  <h1 class="header-title">Create Workshop Volume</h1>
  <fieldset>
    <legend>Workshop Details</legend>
    <i> Please provide details about the workshop in the following section. Optional fields can be left blank if not applicable. </i>
    {% csrf_token %}
    {{ form.as_p }}
  </fieldset>
  <hr>    
  <fieldset id="session_fieldset">
    <legend>Session</legend>
    <i> If the workshop has different sessions, please provide the titles of these sessions in this section. If no splits exist, please leave blank.</i>
      <br>
      <br>
      {{ session_form.management_form}}
      <div class="session-form" id="session-form">
        {% for form in session_form%}
          {{ form }}
          <br>
          {% endfor %}
        </div>
  <input type="button" value="Add Session" class="button-13" id="add_session">
  <div id="empty_form" style="display:none">
    <table class='no_error'>
        {{ session_form.empty_form }}
        <br>

    </table>
</div>

</fieldset>
  <fieldset id="editor-fieldset">
    <legend>Editors</legend>
    <i> Please provide details on the editors in this section. Also provide your own details if you are also an editor. </i>
    {{ editor_form.management_form }}
    <div id="form-set">
      {% for form in editor_form %}
      <div class="editor-form">
        {{ form.as_p }}
        <hr>
      </div>
      {% endfor %}
      
    </div>
    <button id="add-form" class="button-13">Add Editor</button>
  </fieldset>
  <br>
  <input type="submit" class="button-13" value="Save Workshop">
</form>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $('#add_session').click(function() {
    var form_idx = $('#id_session-TOTAL_FORMS').val();
    $('#session-form').append($('#empty_form').html().replace(/__prefix__/g, form_idx));
    $('#id_session-TOTAL_FORMS').val(parseInt(form_idx) + 1);
});

  document.addEventListener('DOMContentLoaded', function() {
    let addButton = document.querySelector("#add-form");
    let formSet = document.querySelector("#editor-fieldset");
    let totalForms = document.querySelector("#id_editor-TOTAL_FORMS"); // Update the ID selector
    let startDateInput = document.querySelector('#id_workshop_begin_date');
    let endDateInput = document.querySelector('#id_workshop_end_date');

    function addForm(e) {
        e.preventDefault();

        let formNum = formSet.querySelectorAll(".editor-form").length - 1;
        let newForm = formSet.querySelector(".editor-form").cloneNode(true);
        let formRegex = RegExp(`editor-(\\d+)-`, 'g'); // Update the prefix

        formNum++;

        newForm.innerHTML = newForm.innerHTML.replace(formRegex, `editor-${formNum}-`); // Update the prefix
        formSet.insertBefore(newForm, addButton);

        totalForms.value = formNum + 1;
    }

    addButton.addEventListener('click', addForm);

    function updateEndDateMin() {
        endDateInput.setAttribute('min', startDateInput.value);
        if (endDateInput.value && startDateInput.value > endDateInput.value) {
            endDateInput.value = startDateInput.value;
        }
    }

    function updateStartDateMax() {
        if (startDateInput.value && startDateInput.value > endDateInput.value) {
            startDateInput.value = endDateInput.value;
        }
    }

    startDateInput.addEventListener('change', updateEndDateMin);

    endDateInput.addEventListener('change', updateStartDateMax);

    if (startDateInput.value) {
        updateEndDateMin();
    } else if (endDateInput.value) {
        updateStartDateMax();
    }
});
</script>


{% endblock %}